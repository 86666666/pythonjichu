import requests
import time
from datetime import datetime

qe=requests.session()
a='Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvYzQ2NDA3YmItNTBmNC00YjUwLWFkMWEtZDhiYTIyMTRjZGUzLyIsImlhdCI6MTY1NjkwMTMxOCwibmJmIjoxNjU2OTAxMzE4LCJleHAiOjE2NTY5MDU3MjEsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBVFFBeS84VEFBQUFrOE8vSHV6ZDN6ZGtTYklVL0FyWnlMNjA5dUJNejQwVUFmcUtRM1ZsakppL3VSSkRJMGdBY0g5aGFlRithU3ZBIiwiYW1yIjpbInB3ZCJdLCJhcHBpZCI6Ijg3MWMwMTBmLTVlNjEtNGZiMS04M2FjLTk4NjEwYTdlOTExMCIsImFwcGlkYWNyIjoiMiIsImZhbWlseV9uYW1lIjoiV0FORyIsImdpdmVuX25hbWUiOiJCaWxsIiwiaXBhZGRyIjoiMjIyLjcxLjUwLjk4IiwibmFtZSI6IkJpbGwgV0FORyIsIm9pZCI6IjgwYjUzY2JhLWY0NTQtNGViMi1iYjZkLWQyNmEwZjNhOTQ0NSIsIm9ucHJlbV9zaWQiOiJTLTEtNS0yMS0xMTU1MjY4MDI5LTI2ODYxMDkxMTgtMzg5MDYyOTIyNi0zNjQzNCIsInB1aWQiOiIxMDAzMjAwMUVBODY4RUREIiwicmgiOiIwLkFWTUF1d2RreFBSUVVFdXRHdGk2SWhUTjR3a0FBQUFBQUFBQXdBQUFBQUFBQUFCVEFQYy4iLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzaWduaW5fc3RhdGUiOlsia21zaSJdLCJzdWIiOiJhMHF6dnBSWGlobW9PVU5QYWM4SnNJczJnS3Jmcl9NTXpTV1Y4ZldsZnprIiwidGlkIjoiYzQ2NDA3YmItNTBmNC00YjUwLWFkMWEtZDhiYTIyMTRjZGUzIiwidW5pcXVlX25hbWUiOiJiaWxsLndhbmdAdGFwLWdyb3VwLmNvbS5jbiIsInVwbiI6ImJpbGwud2FuZ0B0YXAtZ3JvdXAuY29tLmNuIiwidXRpIjoibDFGdk5HRndLMEdjVDZsNUJjVmhBQSIsInZlciI6IjEuMCIsIndpZHMiOlsiYjc5ZmJmNGQtM2VmOS00Njg5LTgxNDMtNzZiMTk0ZTg1NTA5Il19.CDm6mX-nFTDix9hzFXkAIX1OIjGhiKtAxI7KrFpZKrpROaogtu_Uf3vxC9eQ4Ep7hDLbk4tpenYXm1VCvqtUJ5LnbLQtxF_DHB-M5dpaf1bocVeZZYmfBi4a_GunJTP1bm6pyp7RGEsqrgOQYUlPcfBXccV-Bt-ProWLLQuEgtIO2X9ucjVUSMZnfpW-egZrsWXrmMUTxATO31F9FlXwkpeH44FNjY18ICVnHEeTDT-olFJngzgxn7wkI390xxGBjowP6If58SINjbpour-v4Hqg8eWkTXGDguJ-xo2aQvTzxzJq_G4H8gIkOr-kl6nvKOdgccP9NKfvns6E_WeFfA'
headers = {
'Host': 'wabi-mc-sha-redirect.analysis.chinacloudapi.cn',
'User-Agent': r'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0',
'Accept': 'application/json, text/plain, */*',
'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',
'Accept-Encoding': 'gzip, deflate, br',
'ActivityId': 'a20c5d78-b651-41b6-9375-6118605cd6e2',
'RequestId': 'fcfbf0ad-963e-3287-158f-4f72a22fa52b',
'Authorization':a,
'Content-Type': 'application/json;charset=UTF-8',
'Origin': 'https://app.powerbi.cn',
'Connection': 'keep-alive',
'Referer': 'https://app.powerbi.com/',
'Content-Length': '0',
'TE': 'Trailers'}


headers2 = {
'Host': 'wabi-mc-sha-redirect.analysis.chinacloudapi.cn',
'User-Agent': r'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0',
'Accept': 'application/json, text/plain, */*',
'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',
'Accept-Encoding': 'gzip, deflate, br',
'ActivityId': 'a20c5d78-b651-41b6-9375-6118605cd6e2',
'RequestId': 'fcfbf0ad-963e-3287-158f-4f72a22fa52b',
#'Authorization':a,
'Content-Type': 'application/json;charset=UTF-8',
'Origin': 'https://app.powerbi.cn',
'Connection': 'keep-alive',
'Referer': 'https://app.powerbi.com/',
'Content-Length': '0',
'TE': 'Trailers'}
cookies='ai_user=bbPGc|2022-07-03T12:49:28.698Z; PowerBIUserSignedUp=1; PowerBISignedInFlag=1; PreferredLanguage=zh-Hans; ASP.NET_SessionId=wmar2kgesrngr4iyzqyl0ko1; WFESessionId=1c5434cd-4669-47e7-9c63-633614dd3dfa; ARRAffinity=79e06db539acb57119e709978d2cf1da299e8341753d6f6345007fcab3f69bc5; ARRAffinitySameSite=79e06db539acb57119e709978d2cf1da299e8341753d6f6345007fcab3f69bc5; .AspNet.Cookies=chunks:2; LoginErrorReattemptCount=0; .AspNet.CookiesC1=H4sIAAAAAAAEAJ1YW3OzuLL9Rd8uLsYzfozNzdgSQegCepkC5ASDwCTBAfPrT-N8s_fsU3VezkPKwUKtVvfq1at9eUR1GVTX-BqlbDma-Hr8OnbjIA_H7bGpHEyPdkylh2g7J03tJcu7jZYoiJncJwveExfZ8Okijxmx2zq48a7nQ7TBWbLa1Ly9mbmOPvNuaIpwQDg1F2qTOPb3e8z0yA22vm9cspf1_RM3k-tb8q8LuKXEauK4wYvfINeb5NUwJc3nMyVd3nhj7OI6fxhO7OYzCjxbgouIvqzmhspGq7mbCslULbfvs42N6uHYhXDa0lbLuXO0Ouwa7OYGctU1B9soyA2wfcX0ZcxFMuep2cZBVKPmOOMAt5Ki7-N1uhbCN47NbcYNs9Yrx67nwJn3vMuvceNZmOabmLYbCBmEkm8qCCWiuRnTxEH0fY7T6ZoL8wE2rlWo2tVmbu5ueYZv63fc1XccoFm1kqAMJ6KTQeW_TAVTLUvX9Mi6FPrrwnd3sKOfeww_Jo91TQ2q4_fMcuAdtsbgUIj56-l3tq9lQJ7nwp0e56aazw2bzk27WdfLzh9lCmlvo6EMpvf_2HS-yw4_z8ENAjgcjZgiC7mJgWnrILeyzq0zikzjkg8flJFG-fqDdXORLC8ThdQjNmdpZ76SYDSoVvjSmh8y0EXJvQdlKi6MzYN2GnPP-RRi-FSeObJskAz2C03wxZtZGaz7sSFoFJeek6WZeuVeO9F-EMXTz91v2L5PecOW3Irqs8jBx2TEAb-iq3nNG9meRfLAHeCpwTXkxMDPmO7uVRjpku-W4om7iJ6pN-LUeKDUAFwxEzX5BrlH50yP1hNz7oq39xEt7xCD_AFxeeCrseAGCuIANvu9-WPrCO--LKh5mRDje9i7IYx4a8yr7n1dn86tLyjzTWWRz4u_TxnnvspIqILWSkXNaEPs2IuOqSA3EUYBCyrrwrVk2ctYmNGBe36SPzbXJw4BE7_PnXLhDKiVXppxzjtslhy_kkX6SAyI6N0bNt_Hwko2qaf7MyMS8TpNDfXEuQp0u-Y8XxILuy923h1HTPcdPhhGvuJG-C0S3ijd-prD3REljQyARNa9cG6Vcf0PHF5XHJ57VZedelGBD_vVo7T5dO7wd5k6TblST88n-NweuycG78ry79LYGzncU9rRt8pe7rm1G2HP_XlORobVx1Inj9J9cbh1G0mmM9X5HfVrswz9fbLmt5e6Wu023h09c6MGGT454ooX3UHtGvJgLFLkkN9krWvgF89AD8PG3XGOKdGxCxhw2zXGU97pRWYYsLK7_53jfGEGWiAGEB_cPO0AJ1VjLKBWHoaFFvikpJUucEnn_W3HKK2vJ1Ve2G2SvN4XbDek7SgQ9wfq4VMRRGFu6deCDZRnQ4SYM6QZjsqumqWHI9zqj7TzufCiM6W-UKYeKy_KeFcXrIkCwSNehZB3u84okynzMX3uz8gk2v_n_qa9y0yDbyRj4unbt_TqVFl4W9oSAeZMwdUGC_QogfbLjsBdzVR1yUIzfi15PlEXH-D5wXstSzFagteHytODsnQtPGebiuEbuPbImn2TeoZFw9a5dOQI-1vUzaZoKwdZ2MEZh9d8S2QDQa3jJRTLkmngGXIomeMidy8LzW3qq6AwzIxkpCBBPQhOogszGeuGgph8S0MdVYYey6BuE6O1KId6YM6HXPgr9_mGmhj6RzQCj0VFt9sAr3HU7rxi4TH3mLnmqgz4MVnj0bIHnC8xMz1GfUwCtaTCDArdLs94tf7Pc4eHlMqoaPnvXPtZHDzjeeCtDJKO09glgjB5AE4IUoGDwuVNGvw5cY_fmM-mNBteOXNeqTBPyGcPzHEK8YO3IoG9r6V0o4a3EG8xiIvGQdJHaekPOeTSv3jTBPdlhZ0YnNUTtzBnbd2U630Y_4IWveZD8sV3IB9T3up70uAiMYb2x198TPp9scYL1nsE8aWZAh6PRuoTATz9AfGOiTkAeNGEPeNBugHx4MuA-PmANSaDGXgc4svwM_6kVw2x5k_AT3xh-qO0NC6YXuNVQC1kZYg1bzTgq5pL77kukCdfWf-TPxnu25ID_tyjub7Pf_Dp5oBHWP-Nr-gmWpX-236rHRoMDfSZD54pVHRfRir0M9-kJwV73m88VVCLylL_dV6c_ef-cB_YP0jUDjfAm0Sew9jz_nKgop0Lrj9ENyJu-g7tTLg_9MuuBnx5E9X4tz3Irzd85ToHvPt_1xfAiPjKcygKNWbLfgP45IiZH4ISTLzWhPVoxaPIasDbuK730Ee3gF9MfLifueId-kE4xIX2t7R9ngf59GvwZ6CWji6e6SXZAPHwbcq5SFZ7lKScR_5PPPAon1ykbRqMATcJJw30AR095IpRkwvAbSv86Cg99Yk0zgqfs0Ifl5zug0T7nLQR4U88Q5391zMPElP6RPvyQsmzHi5QL896Yjfg10hc-DvwCWkgnk6-HB3Fdc76PeiZ3-9DvGTIa77wLl9wCvwUrvkHzADgjzOs07QjCPC7lb6Knlzb1Tj1cksGDvivwjLYXfmiE66BHKCFUUpo2Tqn3B5OpUYL1H9TujrmPtSLn88Qn6IMyCI6Z6raJ77aFb9P_uJ6y0CvEM9bhDAjyB9LOjNedRHoHK6MOSPdiLnBDdGSG7zPUtBR3I8-AJ_88tse3GfKzVqU_vsDi_rKTb7m6wTEl11CvPLrDfi1TQQJIeuIW8TJGyzA_kh7eWUL_4Be88w379W1YCtezR8828CnK183-wPydZ4APyJjsKRf7xVvH3FGEPCo-ZN_ssZ75T_on0NbwXmlj3mpo21OX5yLHj55O2P4dHKmbpDfn16jAc-Ar7XXkIzjxFjr2WkrfzjS3_mBeDSYDyu_Qr34BqWRKNmOAn_HRVet-O4vnuNRqCewD3xCPpE_MLn4wL8e-DeBtnaawnAQDvRnqvcG5GNkno6VV41FGLkxzx_AZSPUxaMSE-hY7SIeneJQWsTamSRwuFxkXsCYUtCXhzSHE_QW4A4P1mTGDeCNTHsFP26KHmfIlUnMvsbU5K-McafQpLkEHMfen3O6RKZgZpLZ0Rt1o1fgze_SV0sc3hbZzYJb0STt_ME6fiKZxAmT27KPipzxMM1kgzSzZOM7icAfhO1Y3uh7TvWrsngIeYIpiE8p8DQLdgR00hG0znfR7_28r4y00yfS8g_lvlvQWzzZaYK4hJGLW7FQoNm4YFS1hUemoh064P27cHlRGKNbwqkivFmcvm9ANz_OwrwWvk7OInrNGcwINk9k3y4wixngpZMtoH3YsM8WZcW8DvKszjnTPbP1Z7GoOGkVJUGEWetZwPOghX330sP3xtFO2shUrkKXRoO29LvYUxRw1Vfsn_pofEghH_L3fIQOzp635l5l4L9dJ2zlEMgMsckA-Lpxb2OopT6Apm0Lv34Qve8xaAzBV805pokmexageyLUPmn9PWGgEVkygv5FoB0EXRSpOtBpxtBjU2nVR3tpkCWzFUmoTjIr-lShitnBnKtWHkGXAysoKxFjqPRgEn00q45tMlDNea-H1PSpEr7NuLILmEGo538lltPTcP-d86gmVFrK5XuIh4GYZ14abHB76Mq2drml-9zy19rtCTNl7Epbte2i_Nq-BMlMLRzSRmOkyRsKkYND_yGt-ou1f87CIxw0egTzM-i2CrgsGZnlNMpUrOqZpbJqA5yzx130hszaEgxi5c2d9HdvsnU-mf7TLgz_E2qbJhympQC_Fb7SVdOapPWH1KgBjv4WtOpr7EZz2qik6pyl7LFDWDWn_s2Ihb9NoMczClrZ87fQO0PQW6-UqqYIMc0Aa8oezsyub6BbLGXWNuiSluvWKBfolZoj6X1Nl94zUeZ_py2CeV7bTEdjleUW7WCePphF6eszajGmVDZloK2y2-E04GcEcxLc04npi439neB99cB9HZY2TA6tCRytzjCtgb7; .AspNet.CookiesC2=d47Q1LNw5QwI6PjUmIwf9VnWSF8z_oDZaEqjncwbx7-U3jGenVID-APhwE9ilBQXp6ox43MTiCLzhf6RtRKWYQ9wjE_h6k3aRhvk1VQ_Tr4LdnGS4yJZ9QAz_kDLFCwviFzh75L7Ppagp9NNEWphhI5mTlpxQWCcoGARpnYwv0VmGkpStaVzYcENdFEFPGngAPJphM-9v0E90iGydAp8aoiM0ZvV4YTs76UYKGvoAo5tVLmTP9bCABnUS05u4iynJBgf0_ptgu8_UcDgK1cQ6KaXFT0gPHhH6dPGjsMqGe-n7sxSDzh7mVwVzUgl1lov5QETkIGPXqhZPOcyZ3OI59Xddykkow7qF3ObY1ajMvA3ReKxS08vMlbuiDvrLHfjq46LVFGf1a24NwDG5AxRsAd-TIviakk4z1fhH0Ao1p9WmyLB1aXfuxUW27PJHSaOJ2VGDMtAgTFoF9GNp1iQxZKdAE8RCx4LWr4r7Ny7k7RLgIPZIXPbkyPsXiJNCZ4p72jlhFcjlnEX7S1jPNHwBTSkL2kE_YFikEGek5UNl_pw0ZAaunGioTlK_L7TXe96tuY42l0yP0MdxLuSkOrwVcD9lg6w1cJ9QRcFGIBn_wAZGLOCGElGSMD9RMJUCe3Kq6-jS-B-gE_oU8HRZNfMCNZ8NdWqNr4m1o2c2d9iudQV4KZhyQdNuJOQxX_RN-vIAmsZgYUSBk88V5K2gyYZZYyfFl4l1tZHW8Jzdwd9BBbtPmdVTkUXOz-9FLw90NSb8gL_Dy4SW24zpbcLmbeVp4GJyk8IxQB_WKtDfpd7DbL_XVU8GmT3n7D-yQ-TBurHOzDnYzQ7H7cWcruf1N7JAr_xeHZuhOrbmd3md3pGbvKc9_zq6xwk1R3hGW0TZFrnVOzFMBvu_4O8OuV8UqM7VHpyBS2sDe16MozeY5QH8do8PeJ7j9fe6hjlHD-YTf7q-pTOcpReI96Oy9KICflfwfbz-vgYzxhn-h97cQgx0bhNedXr1767W3zFgLf19Ls9I83P28XnWGbgG_gz-jzNPoPfi5mX68TnyL-F-qDpQdf_33iVuPBP22P9r774M5m9lRlr2ka6s-t8-vaXR7l80-x5Hv0rvrfG6ffuaT9XVPy_bFsagaOfWd7IXU3W3Ho8u65ADSv12Nubtr87bnWLEwsJ0Aiz7v5qxXcx0exGV_fXSbhf4Jrk-UrRXl_FtO79-3_lfl2v0Z7eftsnrXGzMw8aVG-_etb_m06_7aZB_BF-1axD0utf1q1W35hz9ytK4IKePeNfbXQWa7lf_a-SvwwZtgbi8X4juaFW8pzOPT7ebk37PLMxv9TLV9h8vkf9-qir-fXxN_gqF593rg_6YRTwd3nz79hk6lau9aezf7jMzxL2ayR8vw-XxV7_9dfhT17q51bdeAGXZbm-WkkXLo7-Hf1SzPLgbKw_f3llMyq_zPVV1XtyH8dFZiRqXzZhO_wMQt9T_JhcAAA; ClusterUri=c46407bb-50f4-4b50-ad1a-d8ba2214cde3=https://wabi-south-east-asia-redirect.analysis.windows.net/; ai_session=ZI9Sn|1656898613489|1656901108970.4'

try:
    refresh_url= 'https://wabi-south-east-asia-redirect.analysis.windows.net/powerbi/content/packages/8788711/refresh/'
    response=qe.post(refresh_url,headers=headers)
    print(response.status_code)
    if response.status_code !=200:
        raise print('出错')
except:
    print('失败了')
    # print(response.cookies)
    # print(type(response.headers))
    time.sleep(120)
    print('第一次初始化刷新')
i=1
while True:
    i=i+1
    response2=qe.post(refresh_url,headers=headers2)
    print(response.status_code)
    print(response.headers)
    #print(response.text)
    time.sleep(120)
    print('第'+str(i)+'次刷新成功')

